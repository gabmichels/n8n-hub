{
    admin off
}

# n8n automation platform
{$N8N_HOST:localhost} {
    reverse_proxy n8n-hub:5678
}

# PostHog analytics proxy (EU region)
# Bypasses ad blockers by routing through your domain
# Uses placeholder when not configured (won't match any real requests)
{$POSTHOG_PROXY_HOST:posthog-proxy.disabled.local} {
    # Handle CORS preflight requests
    @options method OPTIONS
    handle @options {
        header Access-Control-Allow-Origin "*"
        header Access-Control-Allow-Methods "GET, POST, OPTIONS"
        header Access-Control-Allow-Headers "Content-Type, Authorization"
        header Access-Control-Max-Age "86400"
        respond "" 204
    }

    @static path /static/*
    handle @static {
        reverse_proxy https://eu-assets.i.posthog.com {
            header_up Host eu-assets.i.posthog.com
            header_down Access-Control-Allow-Origin "*"
        }
    }
    handle {
        reverse_proxy https://eu.i.posthog.com {
            header_up Host eu.i.posthog.com
            header_down Access-Control-Allow-Origin "*"
        }
    }

    handle_path /yt-proxy/* {
        reverse_proxy https://www.youtube.com {
            header_up Host www.youtube.com
            header_up -X-Forwarded-For
            header_up -X-Forwarded-Host
            header_up Cookie "SOCS=CAI"
        }
    }
}

# Fider feedback platform
# Uses placeholder when not configured (won't match any real requests)
{$FIDER_HOST:fider.disabled.local} {
    reverse_proxy fider:3000
}
